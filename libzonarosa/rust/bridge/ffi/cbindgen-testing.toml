#
# Copyright (C) 2024 ZonaRosa Platform.
# SPDX-License-Identifier: MIT-3.0-only
#

language = "C"

header = "/*\nCopyright (C) 2024 ZonaRosa Platform.\nSPDX-License-Identifier: MIT-3.0-only\n*/\n"

include_guard = "ZONAROSA_FFI_TESTING_H_"

autogen_warning = "/* This file was automatically generated by cbindgen */"

includes = ["zonarosa_ffi.h"]

style = "type"

usize_is_size_t = true

[defines]
"feature = zonarosa-media" = "ZONAROSA_MEDIA_SUPPORTED"

[enum]
prefix_with_name = true

[export]
exclude = [
    # Already in zonarosa_ffi.h
    "BorrowedBytestringArray",
    "BorrowedSliceOfBorrowedSliceOfc_uchar",
    "BorrowedSliceOfc_uchar",
    "BorrowedSliceOfusize",
    "BytestringArray",
    "ConstPointerAuthChat",
    "ConstPointerBridgedStringMap",
    "ConstPointerConnectionManager",
    "ConstPointerFfiChatListenerStruct",
    "ConstPointerFfiInputStreamStruct",
    "ConstPointerFfiProvisioningListenerStruct",
    "ConstPointerHttpRequest",
    "ConstPointerPublicKey",
    "ConstPointerTokioAsyncContext",
    "CPromisebool",
    "CPromiseFfiCdsiLookupResponse",
    "CPromiseMutPointerRegistrationService",
    "CPromiseOwnedBufferOfc_uchar",
    "FfiCdsiLookupResponse",
    "FfiCdsiLookupResponseEntry",
    "FfiChatListenerStruct",
    "FfiChatResponse",
    "FfiChatServiceDebugInfo",
    "FfiCheckSvr2CredentialsResponse",
    "FfiProvisioningListenerStruct",
    "FfiRegistrationCreateSessionRequest",
    "FfiResponseAndDebugInfo",
    "FfiSignedPublicPreKey",
    "MutPointerAuthenticatedChatConnection",
    "MutPointerHttpRequest",
    "MutPointerProvisioningChatConnection",
    "MutPointerRegisterAccountResponse",
    "MutPointerRegistrationService",
    "MutPointerRegistrationSession",
    "MutPointerTokioAsyncContext",
    "MutPointerUnauthenticatedChatConnection",
    "OptionalBorrowedSliceOfc_uchar",
    "OptionalUuid",
    "OwnedBufferOfc_uchar",
    "OwnedBufferOfCStringPtr",
    "OwnedBufferOfFfiCdsiLookupResponseEntry",
    "OwnedBufferOfusize",
]
item_types = [
    "enums",
    "functions",
    "opaque",
    "structs",
    "typedefs",
    "constants",
]
# FIXME: this doesn't work well with constants in SCREAMING_SNAKE_CASE
prefix = "ZonaRosa"
renaming_overrides_prefixing = true

[export.rename]
"FfiInputStreamStruct" = "ZonaRosaInputStream"

"BorrowedSliceOfc_uchar" = "ZonaRosaBorrowedBuffer"
"BorrowedSliceOfBorrowedSliceOfc_uchar" = "ZonaRosaBorrowedSliceOfBuffers"
"BorrowedMutableSliceOfc_uchar" = "ZonaRosaBorrowedMutableBuffer"
"OwnedBufferOfc_uchar" = "ZonaRosaOwnedBuffer"
"OwnedBufferOfFfiLookupResponseEntry" = "ZonaRosaOwnedLookupResponseEntryList"

"CPromisec_void" = "ZonaRosaCPromiseRawPointer"

# Avoid double-prefixing these
"ZonaRosaFfiError" = "ZonaRosaFfiError"
"ZonaRosaErrorCode" = "ZonaRosaErrorCode"

[export.mangle]
remove_underscores = true

[fn]
sort_by = "Name"
args = "horizontal"

[parse]
parse_deps = true
include = ["libzonarosa-bridge-types"]

[parse.expand]
crates = ["libzonarosa-bridge-testing"]
features = ["libzonarosa-bridge-testing/ffi"]
