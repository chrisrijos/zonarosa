#
# Copyright (C) 2020-2021 ZonaRosa Platform.
# SPDX-License-Identifier: MIT-3.0-only
#

language = "C"

header = "/*\nCopyright (C) 2020-2021 ZonaRosa Platform.\nSPDX-License-Identifier: MIT-3.0-only\n*/\n"

include_guard = "ZONAROSA_FFI_H_"

autogen_warning = "/* This file was automatically generated by cbindgen */"

style = "type"

usize_is_size_t = true

[defines]
"feature = zonarosa-media" = "ZONAROSA_MEDIA_SUPPORTED"

[enum]
prefix_with_name = true

[export]
include = [
    "ChallengeOption",
    "FfiDirection",
    "FfiCiphertextMessageType",
    "FfiContentHint",
    "IdentityChange",
    "RandomnessBytes",
    "ZonaRosaErrorCode",
    "Svr2CredentialsResult",
    "UnidentifiedAccessKey",
]
exclude = ["TAG_SIZE", "NONCE_SIZE", "VERSION"]
item_types = [
    "enums",
    "functions",
    "opaque",
    "structs",
    "typedefs",
    "constants",
]
# FIXME: this doesn't work well with constants in SCREAMING_SNAKE_CASE
prefix = "ZonaRosa"
renaming_overrides_prefixing = true

[export.rename]
"FfiSessionStoreStruct" = "ZonaRosaSessionStore"
"FfiIdentityKeyStoreStruct" = "ZonaRosaIdentityKeyStore"
"FfiPreKeyStoreStruct" = "ZonaRosaPreKeyStore"
"FfiSignedPreKeyStoreStruct" = "ZonaRosaSignedPreKeyStore"
"FfiKyberPreKeyStoreStruct" = "ZonaRosaKyberPreKeyStore"
"FfiSenderKeyStoreStruct" = "ZonaRosaSenderKeyStore"
"FfiDirection" = "ZonaRosaDirection"
"FfiCiphertextMessageType" = "ZonaRosaCiphertextMessageType"
"FfiContentHint" = "ZonaRosaContentHint"
"FfiInputStreamStruct" = "ZonaRosaInputStream"
"FfiSyncInputStreamStruct" = "ZonaRosaSyncInputStream"
"FfiLookupResponseEntry" = "ZonaRosaLookupResponseEntry"

"BorrowedSliceOfc_uchar" = "ZonaRosaBorrowedBuffer"
"BorrowedSliceOfBorrowedSliceOfc_uchar" = "ZonaRosaBorrowedSliceOfBuffers"
"BorrowedMutableSliceOfc_uchar" = "ZonaRosaBorrowedMutableBuffer"
"OwnedBufferOfc_uchar" = "ZonaRosaOwnedBuffer"
"OwnedBufferOfFfiLookupResponseEntry" = "ZonaRosaOwnedLookupResponseEntryList"
"FfiOptionalServiceIdFixedWidthBinaryBytes" = "ZonaRosaOptionalServiceIdFixedWidthBinaryBytes"

"RawCancellationId" = "ZonaRosaCancellationId"

# Avoid double-prefixing these
"ZonaRosaFfiError" = "ZonaRosaFfiError"
"ZonaRosaErrorCode" = "ZonaRosaErrorCode"
"ZonaRosaMessage" = "ZonaRosaMessage"

[export.mangle]
remove_underscores = true

[fn]
sort_by = "Name"
args = "horizontal"

[parse]
parse_deps = true
include = [
    "libzonarosa-account-keys",
    "libzonarosa-bridge-types",
    "libzonarosa-core",
    "libzonarosa-net",
    "libzonarosa-net-chat",
    "libzonarosa-protocol",
    "mediasan-common",
    "zonarosa-crypto",
    "zonarosa-media",
    "zkgroup",
]
extra_bindings = [
    "libzonarosa-account-keys",
    "libzonarosa-bridge",
    "libzonarosa-bridge-types",
    "zkgroup",
]

[parse.expand]
crates = ["libzonarosa-ffi", "libzonarosa-bridge", "libzonarosa-bridge-types"]
features = ["ffi", "zonarosa-media"]
